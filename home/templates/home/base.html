{% load staticfiles %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>{% block title %}{% endblock %} | mitsbc</title>
    <link rel="canonical" href="{{ request.build_absolute_uri }}"/>
    <meta name="description" content="SBC (Sloan Business Club) is an on-campus organization at Massachusetts Institute of Technology with the purpose of connecting the MIT campus to the professional world." />
    <meta property="og:image" content="{% static 'home/img/sbclogo.png' %}?v={{ STATIC_VERSION }}" />
    {% block meta %}{% endblock %}
    <link rel="shortcut icon" href="{% static 'home/img/favicon.ico' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/fonts.css' %}?v={{ STATIC_VERSION }}">
    <link rel="stylesheet" type="text/css" href="{% static 'home/css/all.css' %}?v={{ STATIC_VERSION }}">
    {% block css %}{% endblock %}
    {% if not request.session.django_timezone %}
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jstimezonedetect/1.0.4/jstz.js"></script>
    {% endif %}
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    {% block js %}{% endblock %}
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-49095716-1', 'mit.edu');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="navbar">
      <div class="navbar-left">
        <div class="navbar-logo">
          <a href="#" class="home-nav-link"><img id="logo" src="resources/media/logo/SBC-Logo-Light-Square.png"/></a>
        </div>
        <div class="navbar-title" class="home-nav-link">
          <a href="#" class="home-nav-link"><div class="navbar-tall">|</div>SLOAN BUSINESS CLUB</a>
        </div>
      </div>
      <div class="navbar-right">
        {% for item in top_menu.menuitems.all %}
          <div class="nav-link">
            <a href="{{ item.url }}">{{ item.text|upper }}</a>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="main">
      {% block body %}{% endblock %}
    </div>
    <div class="footer">
      &copy; 2015 mitsbc
    </div>
    <script>
      $(document).ready(function() {

        if(window.top !== window.self){
          window.top.location.replace(window.self.location.href);
        }

        var properties = ['email', 'name', 'phone', 'year'];
        if (_.some(properties, function(prop){ return $.cookie('_id' + prop) == undefined; })) {
          var senior = (new Date()).getFullYear();
          if ((new Date()).getMonth() > 6){
            senior += 1;
          }

          $.get("https://sbc.scripts.mit.edu:444/auth/auth.py", function(data) {
            _.forEach(properties, function(prop) {
              $.cookie('_id' + prop, data[prop]);
              $('_id' + prop).val(data[prop]);
            });

            var year = senior + (4 - data.year);
            $.cookie('id_year', year);
            $("#id_year").val(year);

            ga('send', 'event', 'view', 'user', data.email);
            ga('set', '&uid', data.email);
          });
        } else {
          _.forEach(properties, function(prop) {
            $('_id' + prop).val($.cookie('_id' + prop));
          });

          ga('send', 'event', 'view', 'user', email);
          ga('set', '&uid', email);
        }

        {% if not request.session.django_timezone %}
          $.get("{% url 'set_timezone' %}?timezone="+encodeURIComponent(jstz.determine().name()));
        {% endif %}
      });
    </script>
  </body>
</html>
